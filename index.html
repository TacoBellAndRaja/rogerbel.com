<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wavelength Clockface Edition</title>
  <style>
    /* -------------------------------
       Global Reset & Layout
    ------------------------------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
    }
    h1 {
      margin-top: 16px;
      font-size: 1.5rem;
    }
    #game-container {
      margin-top: 16px;
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* -------------------------------
       Zoom Buttons (top‐right)
    ------------------------------- */
    .zoom-controls {
      position: absolute;
      top: 16px;
      right: 16px;
      display: flex;
      flex-direction: column;
      z-index: 10;
    }
    .zoom-controls button {
      width: 36px;
      height: 36px;
      margin-bottom: 8px;
      font-size: 1.25rem;
      background: rgba(255,255,255,0.9);
      border: 2px solid #444;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
    }
    .zoom-controls button:last-child {
      margin-bottom: 0;
    }
    .zoom-controls button:active {
      background: rgba(255,255,255,1);
    }

    /* -------------------------------
       Spectrum Clues & Numbers around Clock
    ------------------------------- */
    #dial-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin-bottom: 12px;
    }
    #dial {
      border: 3px solid #333;
      border-radius: 50%;
      background: #fff;
    }
    .clock-label {
      position: absolute;
      font-size: 1rem;
      font-weight: bold;
      color: #222;
      text-align: center;
      width: 60px;
      pointer-events: none;
    }

    /* -------------------------------
       Controls Section (per phase)
    ------------------------------- */
    .controls-section {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    .controls-section input[type="range"] {
      width: 80%;
    }
    .controls-section button {
      padding: 8px 16px;
      font-size: 1rem;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .controls-section button:disabled {
      background: #777;
      cursor: not-allowed;
    }

    /* -------------------------------
       Result Display
    ------------------------------- */
    #result-display {
      margin: 16px 0;
      font-size: 1.1rem;
      font-weight: bold;
      text-align: center;
      color: #333;
    }

    /* -------------------------------
       Phase Containers
    ------------------------------- */
    .phase {
      display: none;
      flex-direction: column;
      align-items: center;
    }

    /* -------------------------------
       Mobile Responsiveness
    ------------------------------- */
    @media (max-width: 500px) {
      #dial-container {
        width: 300px;
        height: 300px;
      }
      .clock-label {
        width: 50px;
        font-size: 0.9rem;
      }
      .controls-section input[type="range"] {
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <h1>Wavelength: Clockface Edition</h1>
  <div id="game-container">
    <!-- Four‐Anchor Spectrum Label -->
    <div id="spectrum-label" style="margin-bottom:12px; font-size:1.25rem; font-weight:bold; color:#333;">
      Loading…
    </div>

    <!-- Dial Canvas & Numeric/Clue Labels -->
    <div id="dial-container">
      <canvas id="dial" width="400" height="400"></canvas>
      <!-- Labels 1–12 or clue text (for 12,3,6,9) -->
      <div id="label-1" class="clock-label"></div>
      <div id="label-2" class="clock-label"></div>
      <div id="label-3" class="clock-label"></div>
      <div id="label-4" class="clock-label"></div>
      <div id="label-5" class="clock-label"></div>
      <div id="label-6" class="clock-label"></div>
      <div id="label-7" class="clock-label"></div>
      <div id="label-8" class="clock-label"></div>
      <div id="label-9" class="clock-label"></div>
      <div id="label-10" class="clock-label"></div>
      <div id="label-11" class="clock-label"></div>
      <div id="label-12" class="clock-label"></div>
    </div>

    <!-- Phase Controls -->
    <div class="controls-section">

      <!-- 1) Set Target Phase -->
      <div id="phase-set-target" class="phase">
        <label for="target-hour-slider">Clue Giver: Set <strong>Hour</strong> target (0–360°)</label><br>
        <input type="range" id="target-hour-slider" min="0" max="360" value="180"><br>
        <label for="target-minute-slider">Clue Giver: Set <strong>Minute</strong> target (0–360°)</label><br>
        <input type="range" id="target-minute-slider" min="0" max="360" value="180"><br>
        <button id="confirm-target">Lock Targets &amp; Enter Clues</button>
      </div>

      <!-- 2) Enter Clue Phase -->
      <div id="phase-enter-clue" class="phase">
        <label for="clue-hour-input">Clue for <strong>Hour</strong> hand (will appear at 12 & 6):</label><br>
        <input type="text" id="clue-hour-input" placeholder="e.g. “More like springtime”" style="width:80%;"><br>
        <label for="clue-minute-input">Clue for <strong>Minute</strong> hand (will appear at 3 & 9):</label><br>
        <input type="text" id="clue-minute-input" placeholder="e.g. “Closer to midnight”" style="width:80%;"><br>
        <button id="submit-clues">Submit Clues</button>
      </div>

      <!-- 3) Guess Phase -->
      <div id="phase-guess" class="phase">
        <label for="guess-hour-slider">Guess <strong>Hour</strong> hand (0–360°)</label><br>
        <input type="range" id="guess-hour-slider" min="0" max="360" value="180"><br>
        <label for="guess-minute-slider">Guess <strong>Minute</strong> hand (0–360°)</label><br>
        <input type="range" id="guess-minute-slider" min="0" max="360" value="180"><br>
        <button id="submit-guess">Reveal</button>
      </div>

      <!-- 4) Reveal & Score Phase -->
      <div id="phase-reveal" class="phase">
        <div id="result-display"></div>
        <button id="next-round">Next Round</button>
      </div>

    </div>
  </div>

  <!-- Zoom Buttons -->
  <div class="zoom-controls">
    <button id="zoom-in">＋</button>
    <button id="zoom-out">－</button>
  </div>

  <script>
    (() => {
      // -------------------------------
      // List of Possible Spectrums
      // -------------------------------
      const spectrums = [
        { left: "Hot",        right: "Cold" },
        { left: "Soft",       right: "Loud" },
        { left: "Sweet",      right: "Sour" },
        { left: "Light",      right: "Dark" },
        { left: "Old",        right: "New" },
        { left: "Fast",       right: "Slow" },
        { left: "Wet",        right: "Dry" },
        { left: "Smooth",     right: "Rough" },
        { left: "Big",        right: "Small" },
        { left: "Expensive",  right: "Cheap" },
        { left: "Strong",     right: "Weak" },
        { left: "Short",      right: "Tall" },
        { left: "Quiet",      right: "Noisy" },
        { left: "Brave",      right: "Timid" },
        { left: "Happy",      right: "Sad" }
      ];

      // -------------------------------
      // DOM References
      // -------------------------------
      const spectrumLabelEl   = document.getElementById("spectrum-label");
      const dialCanvas        = document.getElementById("dial");
      const dialCtx           = dialCanvas.getContext("2d");

      // Clock‐face labels 1–12
      const clockLabels = {};
      for (let h = 1; h <= 12; h++) {
        clockLabels[h] = document.getElementById(`label-${h}`);
      }

      // Phase containers
      const phaseSetTarget    = document.getElementById("phase-set-target");
      const phaseEnterClue    = document.getElementById("phase-enter-clue");
      const phaseGuess        = document.getElementById("phase-guess");
      const phaseReveal       = document.getElementById("phase-reveal");

      // Inputs & Buttons
      const targetHourSlider    = document.getElementById("target-hour-slider");
      const targetMinuteSlider  = document.getElementById("target-minute-slider");
      const confirmTargetBtn    = document.getElementById("confirm-target");

      const clueHourInput       = document.getElementById("clue-hour-input");
      const clueMinuteInput     = document.getElementById("clue-minute-input");
      const submitCluesBtn      = document.getElementById("submit-clues");

      const guessHourSlider     = document.getElementById("guess-hour-slider");
      const guessMinuteSlider   = document.getElementById("guess-minute-slider");
      const submitGuessBtn      = document.getElementById("submit-guess");

      const resultDisplayEl     = document.getElementById("result-display");
      const nextRoundBtn        = document.getElementById("next-round");

      // Zoom controls
      const zoomInBtn           = document.getElementById("zoom-in");
      const zoomOutBtn          = document.getElementById("zoom-out");

      // -------------------------------
      // Game State Variables
      // -------------------------------
      let horizontalSpectrum = null; // {left,right} for 3/9 o’clock
      let verticalSpectrum   = null; // {left,right} for 12/6 o’clock

      let targetHourCenter   = 180;  // degrees 0–360
      let targetMinuteCenter = 180;  // degrees 0–360
      const TARGET_HALF_ANGLE =  30; // ±30°

      let clueHourText       = "";   // placed at 12 & 6
      let clueMinuteText     = "";   // placed at 3 & 9
      let guessHourValue     = 180;  // degrees
      let guessMinuteValue   = 180;  // degrees

      let zoom = 1.0;
      const ZOOM_STEP = 1.2;
      const MIN_ZOOM = 0.5;
      const MAX_ZOOM = 3.0;

      // Current phase: "setTarget" | "enterClue" | "guess" | "reveal"
      let gamePhase = "loading";

      // -------------------------------
      // Degree → Radian Conversion
      //   0° points to 12 o’clock, increases clockwise
      //   rad = (deg − 90) × π/180
      // -------------------------------
      function degToRad(deg) {
        return (deg - 90) * (Math.PI / 180);
      }

      // -------------------------------
      // Draw the Clockface Dial
      // -------------------------------
      function drawDial(revealPhase = false) {
        const ctx = dialCtx;
        const W = dialCanvas.width;
        const H = dialCanvas.height;
        const cx = W / 2;
        const cy = H / 2;
        const radius = Math.min(W, H) / 2 - 12;

        // Clear
        ctx.clearRect(0, 0, W, H);

        // 1) Radial gradient fill for fun
        const grad = ctx.createRadialGradient(cx, cy, radius * 0.2, cx, cy, radius);
        grad.addColorStop(0, "#FFFBF0");
        grad.addColorStop(0.8, "#FFEBB0");
        grad.addColorStop(1, "#FFD740");
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(cx, cy, radius, 0, Math.PI * 2);
        ctx.fill();

        // 2) Circle outline
        ctx.strokeStyle = "#333";
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.arc(cx, cy, radius, 0, Math.PI * 2);
        ctx.stroke();

        // 3) Draw clock numbers or clue texts at 1–12
        for (let h = 1; h <= 12; h++) {
          // Compute angle for this hour: deg = h*30
          const deg = h * 30;
          const ang = degToRad(deg);
          // Position slightly outside circle
          const tx = cx + (radius + 20) * Math.cos(ang);
          const ty = cy + (radius + 20) * Math.sin(ang);

          let label = "";
          if (h === 12) {
            label = clueHourText || verticalSpectrum.left;
          } else if (h === 3) {
            label = clueMinuteText || horizontalSpectrum.right;
          } else if (h === 6) {
            label = clueHourText || verticalSpectrum.right;
          } else if (h === 9) {
            label = clueMinuteText || horizontalSpectrum.left;
          } else {
            label = h.toString();
          }

          const el = clockLabels[h];
          el.style.display = "block";
          el.textContent = label;
          el.style.left = `${tx - el.offsetWidth / 2}px`;
          el.style.top  = `${ty - el.offsetHeight / 2}px`;
        }

        // Hide labels in phases where not ready
        if (gamePhase === "loading" || gamePhase === "setTarget" || gamePhase === "enterClue") {
          for (let h = 1; h <= 12; h++) {
            clockLabels[h].style.display = "none";
          }
        }

        // 4) If revealPhase, draw target arcs and guess hands
        if (revealPhase) {
          // Hour target zone (green)
          const startH = (targetHourCenter - TARGET_HALF_ANGLE + 360) % 360;
          const endH   = (targetHourCenter + TARGET_HALF_ANGLE) % 360;
          drawArc(cx, cy, radius - 6, startH, endH, "rgba(0,180,0,0.4)");

          // Minute target zone (light green)
          const startM = (targetMinuteCenter - TARGET_HALF_ANGLE + 360) % 360;
          const endM   = (targetMinuteCenter + TARGET_HALF_ANGLE) % 360;
          drawArc(cx, cy, radius - 14, startM, endM, "rgba(0,200,0,0.3)");

          // Hour guess hand (red, thicker)
          drawHand(cx, cy, radius - 30, guessHourValue, "#C62828", 5);

          // Minute guess hand (orange, thinner)
          drawHand(cx, cy, radius - 50, guessMinuteValue, "#FF8F00", 3);
        }
      }

      // Helper to draw a filled arc between start/end degrees
      function drawArc(cx, cy, r, degStart, degEnd, color) {
        const ctx = dialCtx;
        const startA = degToRad(degStart);
        const endA   = degToRad(degEnd);
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        if ((degEnd - degStart + 360) % 360 >= 360 - 1e-6) {
          ctx.arc(cx, cy, r, 0, Math.PI * 2);
        } else if (degEnd < degStart) {
          ctx.arc(cx, cy, r, startA, Math.PI * 2, false);
          ctx.arc(cx, cy, r, 0, endA, false);
        } else {
          ctx.arc(cx, cy, r, startA, endA, false);
        }
        ctx.closePath();
        ctx.fill();
      }

      // Helper to draw a hand from center at given angle
      function drawHand(cx, cy, r, deg, color, width) {
        const ctx = dialCtx;
        const ang = degToRad(deg);
        const x2 = cx + r * Math.cos(ang);
        const y2 = cy + r * Math.sin(ang);
        ctx.strokeStyle = color;
        ctx.lineWidth = width;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(x2, y2);
        ctx.stroke();
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.moveTo(x2, y2);
        const h1 = ang + (5 * Math.PI / 6);
        const h2 = ang - (5 * Math.PI / 6);
        ctx.lineTo(x2 + 10 * Math.cos(h1), y2 + 10 * Math.sin(h1));
        ctx.lineTo(x2 + 10 * Math.cos(h2), y2 + 10 * Math.sin(h2));
        ctx.closePath();
        ctx.fill();
      }

      // -------------------------------
      // Show/Hide Each Phase
      // -------------------------------
      function showPhase(phase) {
        gamePhase = phase;
        phaseSetTarget.style.display  = (phase === "setTarget")   ? "flex" : "none";
        phaseEnterClue.style.display  = (phase === "enterClue")   ? "flex" : "none";
        phaseGuess.style.display      = (phase === "guess")       ? "flex" : "none";
        phaseReveal.style.display     = (phase === "reveal")      ? "flex" : "none";
      }

      // -------------------------------
      // Start a New Round
      // -------------------------------
      function startNewRound() {
        // Pick two distinct random spectrums
        let idx1 = Math.floor(Math.random() * spectrums.length);
        let idx2;
        do {
          idx2 = Math.floor(Math.random() * spectrums.length);
        } while (idx2 === idx1);

        horizontalSpectrum = spectrums[idx1]; // 3/9 o'clock
        verticalSpectrum   = spectrums[idx2]; // 12/6 o'clock

        // Show basic anchor labels at top until clues submitted
        spectrumLabelEl.textContent =
          `12⇑: ${verticalSpectrum.left}   ·   3⇒: ${horizontalSpectrum.right}   ·   6⇓: ${verticalSpectrum.right}   ·   9⇐: ${horizontalSpectrum.left}`;

        // Reset state
        targetHourCenter   = 180;
        targetMinuteCenter = 180;
        guessHourValue     = 180;
        guessMinuteValue   = 180;
        clueHourText       = "";
        clueMinuteText     = "";

        targetHourSlider.value   = 180;
        targetMinuteSlider.value = 180;
        guessHourSlider.value    = 180;
        guessMinuteSlider.value  = 180;

        clueHourInput.value   = "";
        clueMinuteInput.value = "";
        resultDisplayEl.textContent = "";

        // Hide all clock labels initially
        for (let h = 1; h <= 12; h++) {
          clockLabels[h].style.display = "none";
        }

        // Draw blank dial
        drawDial(false);

        // Go to Set Target phase
        showPhase("setTarget");
      }

      // -------------------------------
      // Phase Event Handlers
      // -------------------------------

      // 1) Lock Targets & Enter Clues
      confirmTargetBtn.addEventListener("click", () => {
        targetHourCenter   = parseFloat(targetHourSlider.value);
        targetMinuteCenter = parseFloat(targetMinuteSlider.value);
        showPhase("enterClue");
      });

      // 2) Submit Clues
      submitCluesBtn.addEventListener("click", () => {
        const txtH = clueHourInput.value.trim();
        const txtM = clueMinuteInput.value.trim();
        if (!txtH || !txtM) {
          alert("Please enter both hour and minute clues.");
          return;
        }
        clueHourText   = txtH;
        clueMinuteText = txtM;

        // Show clock labels now
        for (let h = 1; h <= 12; h++) {
          clockLabels[h].style.display = "block";
        }
        drawDial(false);

        showPhase("guess");
      });

      // 3) Submit Guess & Reveal
      submitGuessBtn.addEventListener("click", () => {
        guessHourValue   = parseFloat(guessHourSlider.value);
        guessMinuteValue = parseFloat(guessMinuteSlider.value);

        // Angular distances 0–180
        let diffH = Math.abs(guessHourValue - targetHourCenter) % 360;
        if (diffH > 180) diffH = 360 - diffH;
        let diffM = Math.abs(guessMinuteValue - targetMinuteCenter) % 360;
        if (diffM > 180) diffM = 360 - diffM;

        // Scoring: hour hand ×2 points
        const hourScoreRaw   = Math.max(0, 100 - 2 * diffH);
        const minuteScoreRaw = Math.max(0, 100 - 2 * diffM);
        const hourScore   = hourScoreRaw * 2;
        const minuteScore = minuteScoreRaw;
        const totalScore  = Math.round(hourScore + minuteScore);

        resultDisplayEl.innerHTML = `
          <div>Hour target: <strong>${targetHourCenter.toFixed(0)}°</strong> &nbsp;|&nbsp; Your hour guess: <strong>${guessHourValue.toFixed(0)}°</strong> (Δ = ${diffH.toFixed(1)}°)</div>
          <div>Minute target: <strong>${targetMinuteCenter.toFixed(0)}°</strong> &nbsp;|&nbsp; Your minute guess: <strong>${guessMinuteValue.toFixed(0)}°</strong> (Δ = ${diffM.toFixed(1)}°)</div>
          <div>Hour points (×2): <strong>${hourScoreRaw.toFixed(1)}×2 = ${hourScore.toFixed(0)}</strong></div>
          <div>Minute points: <strong>${minuteScoreRaw.toFixed(1)}</strong></div>
          <div><strong>Total Score: ${totalScore}</strong> pts</div>
        `;
        drawDial(true);
        showPhase("reveal");
      });

      // 4) Next Round
      nextRoundBtn.addEventListener("click", () => {
        startNewRound();
      });

      // Zoom In/Out
      zoomInBtn.addEventListener("click", () => {
        zoom = Math.min(MAX_ZOOM, zoom * ZOOM_STEP);
        drawDial(gamePhase === "reveal");
      });
      zoomOutBtn.addEventListener("click", () => {
        zoom = Math.max(MIN_ZOOM, zoom / ZOOM_STEP);
        drawDial(gamePhase === "reveal");
      });

      // -------------------------------
      // Live Preview on Sliders
      // -------------------------------
      function drawPreviewArrow(deg, color = "#1565C0", thickness = 3) {
        drawDial(false);
        const ctx = dialCtx;
        const W = dialCanvas.width;
        const H = dialCanvas.height;
        const cx = W / 2;
        const cy = H / 2;
        const radius = Math.min(W, H) / 2 - 12;
        const ang = degToRad(deg);
        const len = radius - 20;
        const x2 = cx + len * Math.cos(ang);
        const y2 = cy + len * Math.sin(ang);

        ctx.save();
        ctx.strokeStyle = color;
        ctx.lineWidth = thickness;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(x2, y2);
        ctx.stroke();
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.moveTo(x2, y2);
        const h1 = ang + (5 * Math.PI / 6);
        const h2 = ang - (5 * Math.PI / 6);
        ctx.lineTo(x2 + 10 * Math.cos(h1), y2 + 10 * Math.sin(h1));
        ctx.lineTo(x2 + 10 * Math.cos(h2), y2 + 10 * Math.sin(h2));
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      }

      targetHourSlider.addEventListener("input", () => {
        drawPreviewArrow(parseFloat(targetHourSlider.value), "#1565C0", 3);
      });
      targetMinuteSlider.addEventListener("input", () => {
        drawPreviewArrow(parseFloat(targetMinuteSlider.value), "#1565C0", 3);
      });
      guessHourSlider.addEventListener("input", () => {
        drawPreviewArrow(parseFloat(guessHourSlider.value), "#1565C0", 3);
      });
      guessMinuteSlider.addEventListener("input", () => {
        drawPreviewArrow(parseFloat(guessMinuteSlider.value), "#1565C0", 3);
      });

      // -------------------------------
      // Initialize First Round
      // -------------------------------
      function initGame() {
        setTimeout(() => {
          startNewRound();
        }, 100);
      }

      initGame();
    })();
  </script>
</body>
</html>
