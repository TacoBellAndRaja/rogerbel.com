<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shopper Experience Investment Portfolio</title>
  <style>
    /* -------------------------------
       Albertsons Blue Theme & Reset
    ------------------------------- */
    :root {
      --header-blue: #004080;      /* Different blue for top banner */
      --primary-blue: #0055A4;     /* EP row */
      --accent-blue: #1E90FF;      /* AOF row */
      --dark-blue: #003f7f;        /* Sidebar */
      --light-bg: #f5f5f5;
      --text-dark: #333;
      --card-bg: #ffffff;
      --border-radius: 4px;
      --gap: 8px;
      --danger-red: #e74c3c;
      --warning-orange: #e67e22;
      --caution-yellow: #f1c40f;
      --safe-green: #2ecc71;
      --blade-width: 320px;
      --sidebar-width: 50px;
      --header-height: 48px;
      --ep-font-size: 15px;
      --aof-font-size: 13px;
      --summary-font-size: 12px;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: var(--light-bg);
      color: var(--text-dark);
      overflow: hidden;
    }

    /* -------------------------------
       Left Sidebar
    ------------------------------- */
    #sidebar {
      position: fixed;
      top: var(--header-height);
      left: 0;
      width: var(--sidebar-width);
      height: calc(100% - var(--header-height));
      background: var(--dark-blue);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: var(--gap);
      z-index: 1001;
    }
    #sidebar a {
      color: white;
      text-decoration: none;
      width: 100%;
      text-align: center;
      padding: 12px 0;
      font-size: 1.2rem;
      position: relative;
    }
    #sidebar a .tooltip {
      visibility: hidden;
      background: #333;
      color: #fff;
      border-radius: var(--border-radius);
      padding: 4px 8px;
      position: absolute;
      left: calc(100% + 8px);
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.75rem;
      white-space: nowrap;
      z-index: 1002;
    }
    #sidebar a:hover .tooltip {
      visibility: visible;
    }

    /* -------------------------------
       Header (Top Banner)
    ------------------------------- */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--header-height);
      background: var(--header-blue);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0 0 var(--border-radius) 0;
      z-index: 1000;
      padding: 0 var(--gap);
    }
    .logo {
      position: absolute;
      left: var(--gap);
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
    }
    header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      max-width: 60%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .search-container {
      position: absolute;
      right: var(--gap);
    }
    .search-container input {
      padding: 4px 8px;
      border-radius: var(--border-radius);
      border: none;
      font-size: 0.9rem;
      width: 180px;
    }

    /* -------------------------------
       Main Content: header rows + assets
    ------------------------------- */
    #mainContent {
      position: absolute;
      top: var(--header-height);
      left: var(--sidebar-width);
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    #mainContent.shifted {
      right: var(--blade-width);
    }

    /* -------------------------------
       Header Rows Container: fixed
    ------------------------------- */
    #headerRows {
      flex: 0 0 auto;
      background: var(--light-bg);
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-top: var(--gap); /* spacing between header and EP row */
      padding-bottom: var(--gap);
      z-index: 10;
      /* horizontal padding to align with assets */
      padding-left: var(--gap);
      padding-right: var(--gap);
    }

    /* Spacing between EP and AOF rows */
    #epRow,
    #aofRow {
      margin-bottom: var(--gap);
    }

    /* -------------------------------
       EP Row (only top corners rounded)
    ------------------------------- */
    #epRow {
      display: grid;
      gap: var(--gap);
      width: 100%;
      align-items: center;
    }
    .ep {
      background: var(--primary-blue);
      color: white;
      padding: 0 8px;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--ep-font-size);
      height: 48px;
      overflow: hidden;
      white-space: normal;
      line-height: 1.2;
    }

    /* -------------------------------
       EP Summary Row (only bottom corners rounded, darker)
    ------------------------------- */
    #epSummaryRow {
      display: grid;
      gap: var(--gap);
      width: 100%;
    }
    .ep-summary {
      background: #bdd8ff;  /* darker */
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      padding: 4px 8px;
      font-size: var(--summary-font-size);
      text-align: center;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      line-height: 1.2;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 28px;
    }

    /* -------------------------------
       AOF Row (only top corners)
    ------------------------------- */
    #aofRow {
      display: grid;
      gap: var(--gap);
      width: 100%;
      align-items: center;
    }
    .aof {
      background: var(--accent-blue);
      color: white;
      padding: 0 6px;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--aof-font-size);
      height: 44px;
      overflow: hidden;
      white-space: normal;
      line-height: 1.2;
    }

    /* -------------------------------
       AOF Summary Row (only bottom corners, darker)
    ------------------------------- */
    #aofSummaryRow {
      display: grid;
      gap: var(--gap);
      width: 100%;
    }
    .aof-summary {
      background: #a3d6c4;  /* darker */
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      padding: 4px 6px;
      font-size: var(--summary-font-size);
      text-align: center;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      line-height: 1.2;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 26px;
    }

    /* -------------------------------
       Assets Area (scrollable)
    ------------------------------- */
    #assetsArea {
      flex: 1 1 auto;
      overflow-y: auto;
      padding-top: var(--gap);
    }
    #assetsGrid {
      display: grid;
      gap: var(--gap);
      width: 100%;
      padding-left: var(--gap);
      padding-right: var(--gap);
    }
    .asset-col {
      display: flex;
      flex-direction: column;
      gap: var(--gap);
      min-width: 0;
    }

    /* -------------------------------
       Status Bar with Icons & Dot
    ------------------------------- */
    .status-bar-container {
      position: relative;
      background: #eee;
      border-radius: var(--border-radius);
      height: 20px;
      margin-top: 6px;
    }
    .status-bar-container .icon {
      position: absolute;
      top: -4px;
      transform: translateX(-50%);
      font-size: 1rem;
    }
    .icon.budget { color: #2ecc71; }
    .icon.time   { color: #f1c40f; }
    .icon.scope  { color: #e67e22; }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      position: absolute;
      top: 8px;
      right: 8px;
    }
    .status-safe    { background: var(--safe-green); }
    .status-caution { background: var(--caution-yellow); }
    .status-warning { background: var(--warning-orange); }
    .status-danger  { background: var(--danger-red); }

    /* -------------------------------
       Asset Card
    ------------------------------- */
    .asset-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 12px;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      min-width: 0;
    }
    .asset-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .asset-card.selected {
      border: 2px solid var(--accent-blue);
      background: #f0f8ff;
    }
    .asset-header {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .asset-owner {
      font-size: 0.85rem;
      color: #555;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* -------------------------------
       Blade Panel
    ------------------------------- */
    #blade {
      position: fixed;
      top: var(--header-height);
      right: 0;
      width: var(--blade-width);
      height: calc(100% - var(--header-height));
      background: white;
      box-shadow: -4px 0 12px rgba(0,0,0,0.15);
      transform: translateX(var(--blade-width));
      transition: transform 0.3s ease;
      z-index: 1002;
      display: flex;
      flex-direction: column;
    }
    #blade.open {
      transform: translateX(0);
    }
    #blade .blade-header {
      background: var(--primary-blue);
      color: white;
      padding: 12px;
      font-size: 1.1rem;
      font-weight: bold;
      position: relative;
    }
    #blade .blade-body {
      padding: 12px;
      overflow-y: auto;
      flex: 1;
    }
    #blade .blade-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: transparent;
      border: none;
      font-size: 1.2rem;
      color: white;
      cursor: pointer;
    }

    /* -------------------------------
       Responsive
    ------------------------------- */
    @media (max-width: 768px) {
      #headerRows .grid-row,
      #assetsGrid {
        display: block;
      }
      #mainContent.shifted {
        right: 0;
      }
      #blade {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav id="sidebar">
    <a href="#" title="Build">🔨<span class="tooltip">Build</span></a>
    <a href="#" title="People">👥<span class="tooltip">People</span></a>
    <a href="#" title="Taxonomy">🧬<span class="tooltip">Taxonomy</span></a>
  </nav>

  <!-- Header -->
  <header>
    <div class="logo">A</div>
    <h1>Shopper Experience Investment Portfolio</h1>
    <div class="search-container">
      <input type="text" id="assetSearch" placeholder="Search assets..." />
    </div>
  </header>

  <!-- Main content -->
  <div id="mainContent">
    <!-- Fixed header rows -->
    <div id="headerRows">
      <div id="epRow" class="grid-row"></div>
      <div id="epSummaryRow" class="grid-row"></div>
      <div id="aofRow" class="grid-row"></div>
      <div id="aofSummaryRow" class="grid-row"></div>
    </div>
    <!-- Scrollable assets -->
    <div id="assetsArea">
      <div id="assetsGrid" class="grid-row"></div>
    </div>
  </div>

  <!-- Blade Panel -->
  <div id="blade">
    <div class="blade-header">
      Asset Details
      <button class="blade-close" id="bladeClose">&times;</button>
    </div>
    <div class="blade-body" id="bladeBody">
      <p>Select an asset to see details.</p>
    </div>
  </div>

  <footer style="text-align:center; margin-top: var(--gap); font-size:0.9rem; color:#777; margin-left: var(--sidebar-width); padding: var(--gap) 0;">
    © 2025 Strategy Team
  </footer>

  <script>
    // ------------------------------------------------
    // Configuration Data
    // ------------------------------------------------
    const config = {
      enterprisePriorities: [
        { id: "EP1", name: "Enterprise Priority 1" },
        { id: "EP2", name: "Enterprise Priority 2" },
        { id: "EP3", name: "Enterprise Priority 3" },
        { id: "EP4", name: "Enterprise Priority 4" },
        { id: "EP5", name: "Enterprise Priority 5" }
      ],
      areasOfFocus: [
        { id: "AOF1", name: "Lorem ipsum dolor sit amet", ep: "EP1" },
        { id: "AOF2", name: "Consectetur adipiscing elit", ep: "EP1" },
        { id: "AOF3", name: "Sed do eiusmod tempor", ep: "EP2" },
        { id: "AOF4", name: "Incididunt ut labore et dolore", ep: "EP3" },
        { id: "AOF5", name: "Magna aliqua quis nostrud", ep: "EP3" },
        { id: "AOF6", name: "Exercitation ullamco laboris nisi", ep: "EP4" },
        { id: "AOF7", name: "Ut aliquip ex ea commodo consequat", ep: "EP5" }
      ],
      assets: [
        // AOF1
        {
          aof: "AOF1",
          name: "Lorem ipsum dolor sit amet, consectetur adipiscing elit",
          owner: "Alice",
          start: "2025-01-01",
          end:   "2025-06-30",
          spent: 50000,
          budget: 100000,
          completedPoints: 40,
          totalPoints: 100,
          details: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Asset 1A is on track."
        },
        {
          aof: "AOF1",
          name: "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua",
          owner: "Bob",
          start: "2025-03-01",
          end:   "2025-09-30",
          spent: 70000,
          budget: 70000,
          completedPoints: 80,
          totalPoints: 100,
          details: "Asset 1B has spent its budget and is nearing completion."
        },
        // AOF2
        {
          aof: "AOF2",
          name: "Ut enim ad minim veniam, quis nostrud exercitation ullamco",
          owner: "Carol",
          start: "2025-02-15",
          end:   "2025-05-15",
          spent: 30000,
          budget: 50000,
          completedPoints: 60,
          totalPoints: 100,
          details: "Asset 2A progressed smoothly; pending final review."
        },
        // AOF3
        {
          aof: "AOF3",
          name: "Laboris nisi ut aliquip ex ea commodo consequat duis aute",
          owner: "David",
          start: "2025-01-20",
          end:   "2025-04-20",
          spent: 45000,
          budget: 60000,
          completedPoints: 50,
          totalPoints: 100,
          details: "Asset 3A is midway; facing minor scope adjustments."
        },
        // AOF4
        {
          aof: "AOF4",
          name: "Irum dolor in reprehenderit in voluptate velit esse cillum dolore",
          owner: "Eve",
          start: "2025-04-01",
          end:   "2025-10-01",
          spent: 20000,
          budget: 80000,
          completedPoints: 20,
          totalPoints: 100,
          details: "Asset 4A kicked off recently; still early phases."
        },
        {
          aof: "AOF4",
          name: "Eu fugiat nulla pariatur excepteur sint occaecat cupidatat non",
          owner: "Frank",
          start: "2025-02-01",
          end:   "2025-08-01",
          spent: 60000,
          budget: 90000,
          completedPoints: 70,
          totalPoints: 100,
          details: "Asset 4B is high priority and well on schedule."
        },
        // AOF5
        {
          aof: "AOF5",
          name: "Proident, sunt in culpa qui officia deserunt mollit anim",
          owner: "Grace",
          start: "2025-03-10",
          end:   "2025-07-10",
          spent: 30000,
          budget: 40000,
          completedPoints: 30,
          totalPoints: 100,
          details: "Asset 5A facing some delays due to resource constraints."
        },
        // AOF6
        {
          aof: "AOF6",
          name: "Id est laborum lorem ipsum dolor sit amet consectetur",
          owner: "Heidi",
          start: "2025-01-05",
          end:   "2025-12-31",
          spent: 100000,
          budget: 150000,
          completedPoints: 50,
          totalPoints: 100,
          details: "Asset 6A is a long-term initiative; steady progress reported."
        },
        // AOF7
        {
          aof: "AOF7",
          name: "Adipiscing elit sed do eiusmod tempor incididunt ut lab",
          owner: "Ivan",
          start: "2025-05-01",
          end:   "2025-09-30",
          spent: 20000,
          budget: 50000,
          completedPoints: 20,
          totalPoints: 100,
          details: "Asset 7A just started; planning stages underway."
        }
      ]
    };

    // Generate additional assets for vertical scrolling test
    config.areasOfFocus.forEach(aof => {
      for (let i = 2; i <= 15; i++) {
        config.assets.push({
          aof: aof.id,
          name: `${aof.name} Asset ${i}`,
          owner: `Owner ${i}`,
          start: "2025-01-01",
          end: "2025-12-31",
          spent: Math.floor(Math.random() * 100000),
          budget: 100000,
          completedPoints: Math.floor(Math.random() * 100),
          totalPoints: 100,
          details: "Extra generated asset for testing vertical scroll."
        });
      }
    });

    let searchTerm = '';

    // ------------------------------------------------
    // Utility Functions
    // ------------------------------------------------
    function daysBetween(date1, date2) {
      const msPerDay = 1000 * 60 * 60 * 24;
      return Math.round((date2 - date1) / msPerDay);
    }
    function calculatePercentages(asset) {
      const today = new Date();
      const startDate = new Date(asset.start);
      const endDate = new Date(asset.end);
      const totalDays = daysBetween(startDate, endDate);
      const elapsedDays = daysBetween(startDate, today);
      const percentTime = Math.min(Math.max((elapsedDays / totalDays) * 100, 0), 100);
      const percentBudget = Math.min((asset.spent / asset.budget) * 100, 100);
      const percentScope = Math.min((asset.completedPoints / asset.totalPoints) * 100, 100);
      return {
        time: Math.round(percentTime),
        budget: Math.round(percentBudget),
        scope: Math.round(percentScope)
      };
    }
    function getStatusColorClass(percs) {
      const values = [percs.time, percs.budget, percs.scope];
      const maxVal = Math.max(...values);
      const minVal = Math.min(...values);
      const diff = maxVal - minVal;
      if (diff <= 10) return 'status-safe';
      if (diff <= 20) return 'status-caution';
      if (diff <= 30) return 'status-warning';
      return 'status-danger';
    }
    function matchesSearch(asset) {
      if (!searchTerm) return true;
      const term = searchTerm.toLowerCase();
      return (
        asset.name.toLowerCase().includes(term) ||
        asset.owner.toLowerCase().includes(term) ||
        asset.details.toLowerCase().includes(term)
      );
    }

    function formatBudget(amount) {
      if (amount >= 1_000_000) {
        return `$${(amount / 1_000_000).toFixed(2)}M`;
      }
      if (amount >= 1_000) {
        return `$${(amount / 1_000).toFixed(0)}K`;
      }
      return `$${amount}`;
    }

    // ------------------------------------------------
    // Compute Summaries
    // ------------------------------------------------
    function computeSummaries() {
      // Total budget across all (matching search) assets
      const filtered = config.assets.filter(matchesSearch);
      const totalBudgetAll = filtered.reduce((sum, a) => sum + a.budget, 0);

      // EP-level summary: count assets + sum budgets per EP
      const epSummary = {};
      config.enterprisePriorities.forEach(ep => {
        const aofs = config.areasOfFocus.filter(aof => aof.ep === ep.id).map(a => a.id);
        const assetsEp = filtered.filter(a => aofs.includes(a.aof));
        const countEp = assetsEp.length;
        const sumBe = assetsEp.reduce((sum, a) => sum + a.budget, 0);
        epSummary[ep.id] = { count: countEp, budget: sumBe };
      });

      // AOF-level summary: count + sum budgets per AOF
      const aofSummary = {};
      config.areasOfFocus.forEach(aof => {
        const assetsA = filtered.filter(a => a.aof === aof.id);
        const countA = assetsA.length;
        const sumBa = assetsA.reduce((sum, a) => sum + a.budget, 0);
        aofSummary[aof.id] = { count: countA, budget: sumBa };
      });

      return { totalBudgetAll, epSummary, aofSummary };
    }

    // ------------------------------------------------
    // Font Resize Based on assetsArea Width
    // ------------------------------------------------
    function updateHeadingFontSizes() {
      const assetsArea = document.getElementById('assetsArea');
      const width = assetsArea.clientWidth;
      let epSize = width / 80;
      let aofSize = width / 90;
      let sumSize = width / 100;
      epSize = Math.min(Math.max(epSize, 12), 20);
      aofSize = Math.min(Math.max(aofSize, 10), 18);
      sumSize = Math.min(Math.max(sumSize, 10), 14);
      document.documentElement.style.setProperty('--ep-font-size', epSize + 'px');
      document.documentElement.style.setProperty('--aof-font-size', aofSize + 'px');
      document.documentElement.style.setProperty('--summary-font-size', sumSize + 'px');
    }

    // ------------------------------------------------
    // Render Functions
    // ------------------------------------------------
    let selectedAssetId = null;

    function render() {
      updateHeadingFontSizes();
      const epRow = document.getElementById('epRow');
      const aofRow = document.getElementById('aofRow');
      const epSummaryRow = document.getElementById('epSummaryRow');
      const aofSummaryRow = document.getElementById('aofSummaryRow');
      const assetsGrid = document.getElementById('assetsGrid');

      // Compute summaries
      const { totalBudgetAll, epSummary, aofSummary } = computeSummaries();

      // Group AOFs by EP
      const aofsByEp = {};
      config.enterprisePriorities.forEach(ep => {
        aofsByEp[ep.id] = config.areasOfFocus.filter(aof => aof.ep === ep.id);
      });

      // Total columns
      const totalAOFs = config.areasOfFocus.length;
      const gridCols = `repeat(${totalAOFs}, 1fr)`;

      epRow.style.gridTemplateColumns = gridCols;
      aofRow.style.gridTemplateColumns = gridCols;
      epSummaryRow.style.gridTemplateColumns = gridCols;
      aofSummaryRow.style.gridTemplateColumns = gridCols;
      assetsGrid.style.gridTemplateColumns = gridCols;

      // Clear previous
      epSummaryRow.innerHTML = '';
      epRow.innerHTML = '';
      aofSummaryRow.innerHTML = '';
      aofRow.innerHTML = '';
      assetsGrid.innerHTML = '';

      // --- Render EP Row ---
      config.enterprisePriorities.forEach(ep => {
        const aofs = aofsByEp[ep.id];
        const startCol = config.areasOfFocus.findIndex(a => a.id === aofs[0]?.id) + 1;
        const countAofs = aofs.length || 1;
        const endCol = startCol + countAofs;

        const epDiv = document.createElement('div');
        epDiv.className = 'ep';
        epDiv.style.gridColumn = `${startCol} / ${endCol}`;
        epDiv.textContent = ep.name;
        epRow.appendChild(epDiv);
      });

      // --- Render EP Summary Row (below EP) ---
      config.enterprisePriorities.forEach(ep => {
        const summary = epSummary[ep.id];
        const count = summary.count;
        const budget = summary.budget;
        const percent = totalBudgetAll
          ? Math.round((budget / totalBudgetAll) * 100)
          : 0;

        const aofs = aofsByEp[ep.id];
        const startCol = config.areasOfFocus.findIndex(a => a.id === aofs[0]?.id) + 1;
        const countAofs = aofs.length || 1;
        const endCol = startCol + countAofs;

        const epSumDiv = document.createElement('div');
        epSumDiv.className = 'ep-summary';
        epSumDiv.style.gridColumn = `${startCol} / ${endCol}`;
        epSumDiv.textContent = `${count} | ${formatBudget(budget)} | ${percent}%`;
        epSummaryRow.appendChild(epSumDiv);
      });

      // --- Render AOF Row ---
      config.areasOfFocus.forEach((aof, idx) => {
        const aofDiv = document.createElement('div');
        aofDiv.className = 'aof';
        aofDiv.style.gridColumn = `${idx + 1}`;
        aofDiv.textContent = aof.name;
        aofRow.appendChild(aofDiv);
      });

      // --- Render AOF Summary Row (below AOF) ---
      config.areasOfFocus.forEach((aof, idx) => {
        const summary = aofSummary[aof.id];
        const count = summary.count;
        const budget = summary.budget;
        const percent = totalBudgetAll
          ? Math.round((budget / totalBudgetAll) * 100)
          : 0;

        const aofSumDiv = document.createElement('div');
        aofSumDiv.className = 'aof-summary';
        aofSumDiv.style.gridColumn = `${idx + 1}`;
        aofSumDiv.textContent = `${count} | ${formatBudget(budget)} | ${percent}%`;
        aofSummaryRow.appendChild(aofSumDiv);
      });

      // --- Render Asset Columns ---
      config.areasOfFocus.forEach(aof => {
        const colDiv = document.createElement('div');
        colDiv.className = 'asset-col';

        const assets = config.assets
          .filter(asset => asset.aof === aof.id && matchesSearch(asset))
          .sort((a, b) => a.name.localeCompare(b.name));
        assets.forEach(asset => {
          const percs = calculatePercentages(asset);
          const statusClass = getStatusColorClass(percs);

          const statusDot = document.createElement('div');
          statusDot.className = `status-indicator ${statusClass}`;

          const statusBarCon = document.createElement('div');
          statusBarCon.className = 'status-bar-container';

          const budgetIcon = document.createElement('span');
          budgetIcon.className = 'icon budget';
          budgetIcon.textContent = '💲';
          budgetIcon.style.left = `${percs.budget}%`;
          statusBarCon.appendChild(budgetIcon);

          const timeIcon = document.createElement('span');
          timeIcon.className = 'icon time';
          timeIcon.textContent = '⏰';
          timeIcon.style.left = `${percs.time}%`;
          statusBarCon.appendChild(timeIcon);

          const scopeIcon = document.createElement('span');
          scopeIcon.className = 'icon scope';
          scopeIcon.textContent = '🔨';
          scopeIcon.style.left = `${percs.scope}%`;
          statusBarCon.appendChild(scopeIcon);

          const card = document.createElement('div');
          card.className = 'asset-card';
          card.dataset.assetId = asset.name;
          if (asset.name === selectedAssetId) card.classList.add('selected');
          card.appendChild(statusDot);

          const header = document.createElement('div');
          header.className = 'asset-header';
          header.textContent = asset.name;
          const ownerSpan = document.createElement('div');
          ownerSpan.className = 'asset-owner';
          ownerSpan.textContent = `Owner: ${asset.owner}`;
          card.appendChild(header);
          card.appendChild(ownerSpan);
          card.appendChild(statusBarCon);

          colDiv.appendChild(card);
        });

        assetsGrid.appendChild(colDiv);
      });

      // Attach click listeners
      document.querySelectorAll('.asset-card').forEach(card => {
        card.addEventListener('click', () => {
          selectAsset(card.dataset.assetId);
        });
      });
    }

    // ------------------------------------------------
    // Blade Functions
    // ------------------------------------------------
    function selectAsset(assetId) {
      selectedAssetId = assetId;
      render();

      const asset = config.assets.find(a => a.name === assetId);
      const bladeBody = document.getElementById('bladeBody');
      bladeBody.innerHTML = `
        <h2>${asset.name}</h2>
        <p><strong>Owner:</strong> ${asset.owner}</p>
        <p><strong>Start:</strong> ${asset.start}</p>
        <p><strong>End:</strong> ${asset.end}</p>
        <p><strong>Spent:</strong> $${asset.spent.toLocaleString()} / $${asset.budget.toLocaleString()}</p>
        <p><strong>Scope:</strong> ${asset.completedPoints} / ${asset.totalPoints} story points</p>
        <hr>
        <p>${asset.details}</p>
      `;

      document.getElementById('blade').classList.add('open');
      document.getElementById('mainContent').classList.add('shifted');
      updateHeadingFontSizes();
    }

    function closeBlade() {
      document.getElementById('blade').classList.remove('open');
      document.getElementById('mainContent').classList.remove('shifted');
      selectedAssetId = null;
      render();
    }

    // ------------------------------------------------
    // Search Handler & Initialization
    // ------------------------------------------------
    window.addEventListener('DOMContentLoaded', () => {
      render();
      document.getElementById('bladeClose').addEventListener('click', closeBlade);

      const searchInput = document.getElementById('assetSearch');
      searchInput.addEventListener('input', (e) => {
        searchTerm = e.target.value.trim();
        render();
      });

      window.addEventListener('resize', () => {
        updateHeadingFontSizes();
      });
    });
  </script>
</body>
</html>
